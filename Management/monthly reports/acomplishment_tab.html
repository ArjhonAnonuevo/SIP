<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Reports</title>
    <link rel="stylesheet" href="../css/dist/output.css">
    <script src="../css/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.11.0/toastify.min.js"></script>
</head>
<body class="bg-gray-100">
<div id="navs"></div>
<div class="xl:mt-10">
    <div class="flex justify-center">
        <div class="xl:ml-40">
            <div class="mx-auto md:max-w-7xl md:max-h-min xl:bg-white md:bg-white shadow-md p-6 mt-8 rounded-md max-w-screen-sm">
                <div class="flex flex-col md:flex-row md:justify-between items-center mb-5">
                    <h2 class="text-2xl font-bold mb-6 md:mb-0 md:text-3xl font-kanit">Daily Activities</h2>
                    <button id="openModalButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Open Modal</button>
                </div>
                <div class="container mx-auto p-6 rounded-lg flex flex-col sm:flex-row">
                    <div class="bg-gray-100 shadow-xl p-6 rounded-lg mb-6 sm:mb-0 sm:mr-6">
                        <form action="submit.php" method="POST">
                            <div class="flex flex-wrap gap-4">
                                <div class="w-full md:w-1/2 lg:w-auto flex flex-col mb-4">
                                    <label for="date" class="mb-1 font-">Date</label>
                                    <input type="date" id="date" name="date"
                                           class="w-full rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md">
                                </div>
                                <div class="w-full md:w-1/2 lg:w-1/3 flex flex-col mb-4">
                                    <label for="type" class="mb-1">Time</label>
                                    <input type="time" id="type" name="time"
                                           class="w-full rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md">
                                </div>
                                <div class="w-full md:w-1/2 lg:w-1/6 flex flex-col mb-4">
                                    <label for="status" class="mb-1">Status</label>
                                    <select id="status" name="status"
                                            class="w-full rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md">
                                        <option value="complete">Complete</option>
                                        <option value="not_complete">Not Complete</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label for="textarea" class="block mb-1">Task Description:</label>
                                <textarea id="textarea" name="type" rows="4"
                                          class="w-full border border-gray-300 rounded px-4 py-2"
                                          placeholder="Enter your text here..."></textarea>
                            </div>
                            <div class="flex justify-center mt-4">
                                <button class="bg-blue-400 text-white font-bold font-poppins py-2 px-4 border rounded-2xl hover:bg-blue-600 hover:text-white transition duration-300">Save
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Another Container -->
                    <div class="bg-gray-100 shadow-xl p-6 rounded-lg">
                        <div class="flex flex-col mb-4">
                            <label for="selectMonth" class="mb-1">Select Month:</label>
                            <select id="selectMonth" class="border border-gray-300 rounded px-4 py-2">
                                <option value="" disabled selected>Select a month</option>
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3">March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                        </div>
                        <h2 class="text-gray-800 font-rubik text-md mb-4">Your Tasks</h2>
                        <div class="overflow-y-auto scrollbar-hide">
                            <div id="taskContainer" class="text-gray-800"></div>
                        </div>
                        <form id="downloadForm" action="generate.php" method="post">
                            <div class="flex justify-center mt-10">
                                <input type="hidden" id="selectedMonth" name="selectedMonth">
                                <button id="downloadButton" name="download"
                                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Download
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

            </div>
            <div id="taskModal"
                 class="hidden fixed inset-0 z-50 overflow-auto bg-gray-800 bg-opacity-50 flex justify-center items-center">
                <div class="bg-white p-8 rounded-lg w-full sm:w-64 md:w-96 lg:w-128 xl:w-160 mx-auto shadow-lg">
                    <h2 class="text-xl font-semibold mb-6 font-kanit text-center text-gray-800">Activity</h2>
                    <div class="grid grid-cols-2 gap-x-6 mb-6">
                        <div class="flex flex-col">
                            <label for="modalDate" class="mb-2 text-sm font-medium text-gray-700">Date:</label>
                            <div id="modalDate" class="flex-grow text-gray-600 rounded-md"></div>
                        </div>
                        <div class="flex flex-col">
                            <label for="modalTime" class="mb-2 text-sm font-medium text-gray-700">Time:</label>
                            <div id="modalTime" class="flex-grow text-gray-600"></div>
                        </div>
                    </div>
                    <div class="flex flex-col mb-6">
                        <label for="modalType" class="mb-2 text-sm font-medium text-gray-700 font-rubik">Task:</label>
                        <textarea id="modalType"
                                  class="w-full h-3/5 border border-gray-300 rounded-md px-4 py-2 resize-none font-poppins"
                                  readonly></textarea>
                    </div>
                    <div class="flex items-center mb-6">
                        <label for="modalStatus" class="mr-2 text-sm font-medium text-gray-700 font-rubik">Status:</label>
                        <div id="modalStatus" class="flex-grow text-gray-600     "></div>
                    </div>
                    <button id="closeModal"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Close
                    </button>
                </div>
            </div>

            <!-- Modal for File Upload -->
            <div id="uploadModal" class="hidden fixed inset-0 z-50 overflow-auto bg-gray-800 bg-opacity-50 flex justify-center items-center">
                <div class="bg-white p-8 rounded-lg w-full sm:w-64 md:w-96 lg:w-128 xl:w-160 mx-auto shadow-lg">
                    <h2 class="text-xl font-semibold mb-6 font-kanit text-center text-gray-800">Upload File</h2>
                    <input type="file" id="regi" class="mb-4">
                    <p id="MonthlyReportsfileName" class="mb-6 text-gray-600"></p>
                    <button id="closeUploadModal" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Close</button>
                </div>
            </div>

        </div>
        <script>
          $(document).ready(function () {
              // Load the navigation content
              $("#navs").load("../header/interns_nav.html");
      
              // Function to handle changes in the month dropdown
              $('#selectMonth').change(function () {
                  var selectedMonth = $(this).val();
                  console.log('Selected month:', selectedMonth);
                  // Update the value of the hidden input field
                  $('#selectedMonth').val(selectedMonth);
                  // Send the selected month value to the server via AJAX
                  $.ajax({
                      url: 'fetch-dailytask.php',
                      method: 'POST',
                      data: {
                          month: selectedMonth
                      }, // Send selected month as data
                      dataType: 'json', // Change data type if needed
                      success: function (response) {
                          // Handle success response here
                          console.log('Response:', response);
                          // Display the fetched tasks
                          displayTasks(response);
                      },
                      error: function (xhr, status, error) {
                          // Handle error here
                          console.error(xhr.responseText);
                      }
                  });
              });
      
              // AJAX request to fetch username
              $.ajax({
                  url: "../header/header.php",
                  method: "GET",
                  success: function (response) {
                      console.log("Username:", response);
                      $("#username").val(response.trim());
                  },
                  error: function (xhr, status, error) {
                      console.error("Error fetching username:", error);
                  }
              });
      
              // Function to display the fetched tasks
              function displayTasks(tasks) {
                  var taskContainer = $('#taskContainer');
                  taskContainer.empty(); // Clear previous tasks
                  tasks.forEach(function (task) {
                      // Create a button for each task date
                      var taskButton = $('<button>')
                          .text(task.date)
                          .addClass('text-blue-600 underline font-bold py-2 px-4 rounded m-2 block');
                      // Attach a click event handler to the button
                      taskButton.click(function () {
                          var formattedTime = formatTime(task.time);
                          // Set task details in the modal
                          $('#modalDate').text(task.date);
                          $('#modalTime').text(formattedTime);
                          $('#modalStatus').text(task.status);
                          $('#modalType').text(task.type);
                          // Show the modal
                          $('#taskModal').removeClass('hidden');
                      });
                      // Append the button to the container
                      taskContainer.append(taskButton);
                  });
              }
      
              // Function to format time to 12-hour format
              function formatTime(timeString) {
                  var time = timeString.split(':');
                  var hours = parseInt(time[0]);
                  var minutes = parseInt(time[1]);
                  var meridiem = hours >= 12 ? 'PM' : 'AM';
                  hours = hours % 12 || 12; // Handle midnight
                  minutes = minutes < 10 ? '0' + minutes : minutes;
                  return hours + ':' + minutes + ' ' + meridiem;
              }
      
              // Close modal when close button is clicked
              $('#closeModal').click(function () {
                  $('#taskModal').addClass('hidden');
              });
                $('#closeUploadModal').click(function () {
                  $('#uploadModal').addClass('hidden');
              });
      
              // Function to handle opening the upload modal
              $("#openModalButton").click(function () {
                  // Show the upload modal
                  $("#uploadModal").removeClass("hidden");
              });
      
              // Submit the form only when the user clicks the "Download" button
              $('#downloadButton').click(function () {
                  $('#downloadForm').submit();
              });
      
              // Bind the change event to the file input using jQuery
              $('#regi').on('change', function () {
                  showFileName(this.files, 'MonthlyReportsfileName');
              });
      
              // Function to update and display the filename when a file is selected
              function showFileName(files, targetId) {
                  if (files.length > 0) {
                      var fileName = files[0].name;
                      $('#' + targetId).text(fileName);
                  } else {
                      $('#' + targetId).text("No file selected");
                  }
              }
          });
      </script>
      
</body>
</html>
